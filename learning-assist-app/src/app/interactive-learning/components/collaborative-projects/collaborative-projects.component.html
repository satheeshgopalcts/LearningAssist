<div class="collaborative-projects-container">
  <!-- Projects List View -->
  <div *ngIf="viewMode === 'list'" class="projects-list-view">
    <div class="header-section">
      <h2>
        <mat-icon>group_work</mat-icon>
        Collaborative Projects
      </h2>
      <p class="subtitle">Work together on exciting projects and build amazing things</p>
    </div>

    <!-- Create New Project -->
    <mat-card class="create-project-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>add</mat-icon>
          Create New Project
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="form-grid">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Project Title</mat-label>
            <input matInput [(ngModel)]="newProjectTitle" placeholder="Enter project title">
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Description</mat-label>
            <textarea matInput [(ngModel)]="newProjectDescription" rows="3" placeholder="Describe your project"></textarea>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Deadline</mat-label>
            <input matInput [matDatepicker]="deadlinePicker" [(ngModel)]="newProjectDeadline">
            <mat-datepicker-toggle matIconSuffix [for]="deadlinePicker"></mat-datepicker-toggle>
            <mat-datepicker #deadlinePicker></mat-datepicker>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Team Size</mat-label>
            <mat-select [(ngModel)]="newProjectMaxTeamSize">
              <mat-option value="2">2 members</mat-option>
              <mat-option value="3">3 members</mat-option>
              <mat-option value="4">4 members</mat-option>
              <mat-option value="5">5 members</mat-option>
              <mat-option value="6">6 members</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </mat-card-content>
      <mat-card-actions>
        <button mat-raised-button color="primary" (click)="createProject()">
          <mat-icon>create</mat-icon>
          Create Project
        </button>
        <button mat-button (click)="resetProjectForm()">Reset</button>
      </mat-card-actions>
    </mat-card>

    <!-- Projects Grid -->
    <div class="projects-grid">
      <mat-card *ngFor="let project of projects$ | async" class="project-card" (click)="selectProject(project)">
        <mat-card-header>
          <div mat-card-avatar>
            <mat-icon [ngClass]="'status-' + getStatusColor(project.status)">
              {{ getStatusIcon(project.status) }}
            </mat-icon>
          </div>
          <mat-card-title>{{ project.title }}</mat-card-title>
          <mat-card-subtitle>{{ project.status | titlecase }}</mat-card-subtitle>
        </mat-card-header>

        <mat-card-content>
          <p class="project-description">{{ project.description }}</p>
          
          <div class="project-details">
            <div class="detail-item">
              <mat-icon>schedule</mat-icon>
              <span>{{ getDaysRemaining(project.deadline) }} days remaining</span>
            </div>
            <div class="detail-item">
              <mat-icon>groups</mat-icon>
              <span>{{ project.teams.length }} teams</span>
            </div>
            <div class="detail-item">
              <mat-icon>assignment</mat-icon>
              <span>{{ project.deliverables.length }} deliverables</span>
            </div>
          </div>

          <mat-progress-bar 
            [value]="calculateProjectProgress(project)"
            class="project-progress">
          </mat-progress-bar>
        </mat-card-content>

        <mat-card-actions>
          <button mat-button color="primary">
            <mat-icon>arrow_forward</mat-icon>
            View Details
          </button>
        </mat-card-actions>
      </mat-card>
    </div>
  </div>

  <!-- Project Details View -->
  <div *ngIf="viewMode === 'project' && selectedProject" class="project-details-view">
    <div class="header-section">
      <button mat-icon-button (click)="goBack()">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <div class="header-content">
        <h2>{{ selectedProject.title }}</h2>
        <p class="subtitle">{{ selectedProject.description }}</p>
      </div>
    </div>

    <div class="project-info-grid">
      <mat-card class="project-overview-card">
        <mat-card-header>
          <mat-card-title>Project Overview</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="overview-stats">
            <div class="stat-item">
              <mat-icon>schedule</mat-icon>
              <div>
                <span class="stat-value">{{ formatDate(selectedProject.deadline) }}</span>
                <span class="stat-label">Deadline</span>
              </div>
            </div>
            <div class="stat-item">
              <mat-icon>groups</mat-icon>
              <div>
                <span class="stat-value">{{ selectedProject.teams.length }}</span>
                <span class="stat-label">Teams</span>
              </div>
            </div>
            <div class="stat-item">
              <mat-icon>assignment</mat-icon>
              <div>
                <span class="stat-value">{{ selectedProject.deliverables.length }}</span>
                <span class="stat-label">Deliverables</span>
              </div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Create New Team -->
      <mat-card class="create-team-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>add</mat-icon>
            Create Team
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Team Name</mat-label>
            <input matInput [(ngModel)]="newTeamName" placeholder="Enter team name">
          </mat-form-field>
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Description</mat-label>
            <textarea matInput [(ngModel)]="newTeamDescription" rows="2"></textarea>
          </mat-form-field>
        </mat-card-content>
        <mat-card-actions>
          <button mat-raised-button color="primary" (click)="createTeam()">
            <mat-icon>group_add</mat-icon>
            Create Team
          </button>
        </mat-card-actions>
      </mat-card>
    </div>

    <mat-tab-group class="project-tabs">
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon>groups</mat-icon>
          Teams ({{ selectedProject.teams.length }})
        </ng-template>
        
        <div class="teams-grid">
          <mat-card *ngFor="let team of selectedProject.teams" class="team-card" (click)="selectTeam(team)">
            <mat-card-header>
              <mat-card-title>{{ team.name }}</mat-card-title>
              <mat-card-subtitle>{{ team.members.length }}/{{ selectedProject.maxTeamSize }} members</mat-card-subtitle>
            </mat-card-header>
            
            <mat-card-content>
              <p class="team-description">{{ team.description }}</p>
              
              <div class="team-members">
                <div *ngFor="let member of getFirstThreeMembers(team.members)" class="member-avatar">
                  <mat-icon>person</mat-icon>
                </div>
                <span *ngIf="team.members.length > 3" class="more-members">+{{ getRemainingMembersCount(team.members) }}</span>
              </div>
              
              <div class="team-progress">
                <span class="progress-label">Progress: {{ team.progress }}%</span>
                <mat-progress-bar [value]="team.progress"></mat-progress-bar>
              </div>
            </mat-card-content>
            
            <mat-card-actions>
              <button mat-button color="primary">
                <mat-icon>visibility</mat-icon>
                View Team
              </button>
            </mat-card-actions>
          </mat-card>
        </div>
      </mat-tab>

      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon>assignment</mat-icon>
          Deliverables
        </ng-template>
        
        <div class="deliverables-list">
          <mat-card *ngFor="let deliverable of selectedProject.deliverables" class="deliverable-card">
            <mat-card-header>
              <mat-card-title>{{ deliverable.title }}</mat-card-title>
              <mat-card-subtitle>Due: {{ formatDate(deliverable.dueDate) }}</mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
              <p>{{ deliverable.description }}</p>
              <div class="deliverable-weight">
                Weight: {{ deliverable.weight }}% of final grade
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </mat-tab>

      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon>assessment</mat-icon>
          Evaluation Criteria
        </ng-template>
        
        <div class="criteria-list">
          <mat-card *ngFor="let criterion of selectedProject.evaluationCriteria" class="criterion-card">
            <mat-card-header>
              <mat-card-title>{{ criterion.name }}</mat-card-title>
              <mat-card-subtitle>Weight: {{ criterion.weight }}%</mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
              <p>{{ criterion.description }}</p>
              <div class="rubric-levels">
                <div *ngFor="let level of criterion.rubric" class="rubric-level">
                  <strong>{{ level.name }} ({{ level.points }} pts):</strong>
                  <span>{{ level.description }}</span>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </mat-tab>

      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon>folder</mat-icon>
          Resources
        </ng-template>
        
        <div class="resources-list">
          <mat-list>
            <mat-list-item *ngFor="let resource of selectedProject.resources">
              <mat-icon matListItemIcon>{{ getResourceIcon(resource.type) }}</mat-icon>
              <div matListItemTitle>{{ resource.name }}</div>
              <div matListItemLine>{{ resource.description }}</div>
              <div matListItemMeta>
                <button mat-icon-button>
                  <mat-icon>open_in_new</mat-icon>
                </button>
              </div>
            </mat-list-item>
          </mat-list>
        </div>
      </mat-tab>
    </mat-tab-group>
  </div>

  <!-- Team Details View -->
  <div *ngIf="viewMode === 'team' && selectedTeam" class="team-details-view">
    <div class="header-section">
      <button mat-icon-button (click)="goBack()">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <div class="header-content">
        <h2>{{ selectedTeam.name }}</h2>
        <p class="subtitle">{{ selectedTeam.description }}</p>
      </div>
    </div>

    <!-- Team collaboration content would go here -->
    <mat-card class="team-workspace-card">
      <mat-card-header>
        <mat-card-title>Team Workspace</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <p>Team collaboration tools and workspace will be implemented here.</p>
        <div class="collaboration-tools">
          <button mat-raised-button color="primary" *ngFor="let tool of selectedTeam.collaborativeTools">
            <mat-icon>{{ getCollaborativeToolIcon(tool.type) }}</mat-icon>
            {{ tool.name }}
          </button>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
